<html>
<head>
<!-- Libraries and APIs -->
<script src="/lib/angular.js" charset="utf-8"></script>
<script src="/lib/angular-animate.js" charset="utf-8"></script>
<script src="/lib/ui-bootstrap-tpls-0.11.0.js" charset="utf-8"></script>
<script src="http://platform.twitter.com/widgets.js" charset="utf-8"></script>
<!-- Files for this application -->
<script src="/js/alertController.js" charset="utf-8"></script>
<script src="/js/alertService.js" charset="utf-8"></script>
<script src="/js/buttonController.js" charset="utf-8"></script>
<script src="/js/cloudController.js" charset="utf-8"></script>
<script src="/js/cloudService.js" charset="utf-8"></script>
<script src="/js/dataSourceService.js" charset="utf-8"></script>
<script src="/js/twitterService.js" charset="utf-8"></script>
<script>
	var app = angular.module('tweetcloud', ['ui.bootstrap']);
	app.service('alertService', AlertService);
	app.service('cloudService', CloudService);
	app.service('dataSourceService', DataSourceService);
	app.service('twitterService', TwitterService);
	app.controller('alertController', ['$scope','$animate','alertService',AlertController]);
	app.controller('buttonController', ButtonController);
	app.controller('cloudController', 
		['$scope','$http','$location',
		'alertService','cloudService','dataSourceService','twitterService',
		CloudController]);
</script>

<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap.css"></link>
<style>
button.cloud {}
.nav, .pagination, .carousel, .panel-title a { cursor: pointer; }
.animate-enter, 
.animate-leave
{ 
    -webkit-transition: 400ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;
    -moz-transition: 400ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;
    -ms-transition: 400ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;
    -o-transition: 400ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;
    transition: 400ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;
    position: relative;
    display: block;
    overflow: hidden;
    text-overflow: clip;
    white-space:nowrap;
} 
 
.animate-leave.animate-leave-active,
.animate-enter {
    opacity: 0;
    width: 0px;
    height: 0px;
}
 
.animate-enter.animate-enter-active, 
.animate-leave {
    opacity: 1;
    width: 100%;
    height: 30px;
}
</style>
</head>

<body data-ng-app="tweetcloud" data-ng-controller="cloudController">
<nav role="navigation" class="navbar navbar-default">
	<div class="navbar-header">
		<ul class="nav navbar-nav">
			<li class="dropdown">
				<a role="button" class="dropdown-toggle">{{ sourceTitle }} <span class="caret"></span></a>		
				<ul class="dropdown-menu">
					<li 
						data-ng-repeat="(slug,title) in dataSource.getSourceMenu()" 
						>
					<a data-ng-click="setSource(slug)">{{ title }}</a></li>
				</ul>
			</li>				
			<li data-ng-show="dataSource.isSourceSet()">
				<a>{{ resultCount }}/{{ stringCount }} strings</a>
			</li>
			<li data-ng-show="dataSource.isSourceSet()">
				<a>{{ transformCount }} transformations</a>
			</li>
			<li class="login" data-ng-show="sourceTwitter()">
				<a href="/twauth">Log in with Twitter</a>
			</li>
			<li data-ng-show="dataSource.isSourceSet()">
				<a><span class="label label-primary" ng-repeat="queryterm in getQueryAsArray()">{{queryterm}}<span></a>
			</li>
		</ul>
		<ul class="nav navbar-nav navbar-right" data-ng-show="dataSource.isSourceSet()">
			<li>
				<div class="btn-group">
					<label class="btn btn-lg btn-default" data-ng-click="less()"
							tooltip-placement="bottom" tooltip="Show fewer cloud buttons.">
						<img src="/glyphicons/png/glyphicons_433_minus.png" />
					</label>
					<label class="btn btn-lg btn-default" data-ng-click="more()"
							tooltip-placement="bottom" tooltip="Show more cloud buttons.">
						<img src="/glyphicons/png/glyphicons_432_plus.png" />
					</label>
					<label class="btn btn-lg btn-default" data-ng-click="smaller()"
							tooltip-placement="bottom" tooltip="Make cloud buttons smaller.">
						<img src="/glyphicons/png/glyphicons_115_text_smaller.png" />
					</label>
					<label class="btn btn-lg btn-default" data-ng-click="bigger()"
							tooltip-placement="bottom" tooltip="Make cloud buttons bigger.">
						<img src="/glyphicons/png/glyphicons_116_text_bigger.png" />
					</label>
					<label class="btn btn-lg btn-default" data-ng-click="toggleShowStrings()"
							tooltip-placement="bottom" tooltip="Toggle display of matching strings.">
						<img src="/glyphicons/png/glyphicons_158_show_lines.png" />
					</label>
					<!-- TODO: Load more content when appropriate; hide when not. -->
					<label class="btn btn-lg btn-default" data-ng-click="initialize();"
							tooltip-placement="bottom" tooltip="Load more content.">
						<img src="/glyphicons/png/glyphicons_081_refresh.png" />
					</label> <!-- Currently doesn't work because content is constant -->
					<label class="btn btn-lg btn-default" data-ng-click="resetQuery()"
							tooltip-placement="bottom" tooltip="Clear query.">
						<img src="/glyphicons/png/glyphicons_435_undo.png" />
					</label>
				</div>
			</li>
		</ul>
	</div>
</nav>
<div data-ng-controller="alertController">
	<alert 
		ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)"
		ng-animate="{enter: 'animate-enter', leave: 'animate-leave'}"
	>{{alert.message}}</alert>
</div>
<div class="tc" id="content" data-ng-show="showCloud">
	<!-- TODO Hide the UI until the user is logged into Twitter. -->
	<!-- TODO Animate it. -->
	<button class="cloud btn btn-default btn-xs" 
		data-ng-controller="buttonController"
		data-ng-repeat="(word,wordspec) in cloudData" 
		data-ng-hide="hideThis"
		data-ng-click="addQueryTerm(wordspec.queryTerm);filterContent();"
		data-ng-style="countToStyle(wordspec.count)"
		tooltip-placement="bottom" tooltip="{{ wordspec.count }} instances"
		>{{ word }}</button>
	<ul data-ng-hide="sourceTwitter()" collapse="!showStrings">
		<li data-ng-repeat="matchedString in matches">{{matchedString}}</li>
	</ul>
	<ul data-ng-show="sourceTwitter()" collapse="!showStrings">
		<li data-ng-repeat="tweet in matches">
			{{ tweet.text }} 
			<i>{{ tweet.user.name }}</i>
			<a href="{{ tweetUrl(tweet) }}">{{ formatDateFromTwitter(tweet.created_at) }}</a>
		</li>
	</ul>
</div>
</body>
</html>